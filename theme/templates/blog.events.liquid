{% include 'theme-variables' %}

<section id="blog-wrap" class="section-wrap">
	{% include '__containers-open' %}
	<h1 class="page-header">{{ page_title }}</h1>
	{% if settings.tag-placement == 'main-content' %}{% include 'tag-buttons' %}{% endif %}

	{% include '__default-pagination' %}
	{% paginate blog.articles by default-pagination %}
	
	{% assign today = 'today' | date: '%s' %}
	<!-- Current Events -->
	{% assign first_current = true %}
	{% for article in blog.articles %}
	  {% for tag in article.tags %}
	    {% if tag contains 'date:' %}
	    
	      {% assign dates = tag | remove: 'date:' | split: '-' %}
  	    {% assign date_start = dates.first | split: '/' %}
  	    {% assign date_start = date_start[2] | append: '/' | append: date_start[1] | append: '/' | append: date_start[0] | date: '%s' %}
  	    {% assign date_end = dates.last | split: '/' %}
  	    {% assign date_end = date_end[2] | append: '/' | append: date_end[1] | append: '/' | append: date_end[0] | date: '%s' %}
	      
	      {% if date_start <= today and date_end >= today %}
	        {% if first_current %}
	          <h2>{% include '__localize' with 'Current event' %}</h2>
	          {% assign first_current = false %}
          {% endif %}
          
          <article>
          	<header>
          	  <h3>{{ article.title }}</h3>
          	</header>
          </article>
	        
	      {% endif %}
	    {% endif %}
	  {% endfor %}
	{% endfor %}
	
	<!-- Upcoming Events -->
  {% assign first_upcoming = true %}
	{% for article in blog.articles %}
	  {% for tag in article.tags %}
	    {% if tag contains 'date:' %}
	    
	      {% assign dates = tag | remove: 'date:' | split: '-' %}
  	    {% assign date_start = dates.first | split: '/' %}
  	    {% assign date_start = date_start[2] | append: '/' | append: date_start[1] | append: '/' | append: date_start[0] | date: '%s' %}
  	    {% assign date_end = dates.last | split: '/' %}
  	    {% assign date_end = date_end[2] | append: '/' | append: date_end[1] | append: '/' | append: date_end[0] | date: '%s' %}
	      
	      {% if date_start > today %}
	        {% if first_upcoming %}
	          <h3>{% include '__localize' with 'Next event' %}</h3>
	          {% assign first_upcoming = false %}
          {% endif %}
          
          <article>
          	<header>
          	  <h3>{{ article.title }}</h3>
          	</header>
          </article>
	        
	      {% endif %}
	    {% endif %}
	  {% endfor %}
	{% endfor %}
	
	<!-- Previous Events -->
  {% assign first_previous = true %}
	{% for article in blog.articles %}
	  {% for tag in article.tags %}
	    {% if tag contains 'date:' %}
	    
	      {% assign dates = tag | remove: 'date:' | split: '-' %}
  	    {% assign date_start = dates.first | split: '/' %}
  	    {% assign date_start = date_start[2] | append: '/' | append: date_start[1] | append: '/' | append: date_start[0] | date: '%s' %}
  	    {% assign date_end = dates.last | split: '/' %}
  	    {% assign date_end = date_end[2] | append: '/' | append: date_end[1] | append: '/' | append: date_end[0] | date: '%s' %}
	      
	      {% if date_end < today %}
	        {% if first_previous %}
	          <h3>{% include '__localize' with 'Previous events' %}</h3>
	          {% assign first_previous = false %}
          {% endif %}
          
          <article>
          	<header>
          	  <h3>{{ article.title }}</h3>
          	</header>
          </article>
	        
	      {% endif %}
	    {% endif %}
	  {% endfor %}
	{% endfor %}
	
		{% include 'pagination' %}
	{% endpaginate %}

	<p class="text-right rss-subscribe">
		<i class="fa fa-rss-square text-muted"></i> <a class="text-muted" href="{{ blog.url | append: '.atom' }}">{% include '__localize' with 'Subscribe to RSS feed for ' %} {{ blog.title }}</a>
	</p>
	{% include '__containers-close' %}
</section>